<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Formulaire ‚Äî Facult√©</title>

  <style>
:root{
  --bg:#f4f7fb;
  --card:#ffffff;
  --accent:#2065d1;
  --muted:#6b7280;
  --radius:16px;
}

*{
  box-sizing:border-box;
  font-family: system-ui, -apple-system, BlinkMacSystemFont,
               "Segoe UI", Roboto, Arial, "Amiri", serif;
}

body{
  margin:0;
  background:linear-gradient(180deg,#eef4ff,#f8fafc);
  min-height:100vh;
  display:flex;
  justify-content:center;
  padding:14px;
}

.card{
  background:var(--card);
  width:100%;
  max-width:720px;
  border-radius:var(--radius);
  box-shadow:0 15px 40px rgba(0,0,0,.08);
  padding:18px;
}

header.top{
  text-align:center;
  margin-bottom:22px;
}

header.top img{
  width:140px;
  margin-bottom:12px;
  height:auto;
  max-width:90%;
}

header.top h1{
  font-size:22px;
  margin:6px 0;
}

header.top p{
  font-size:14px;
  color:var(--muted);
  margin:0;
}

form{
  display:flex;
  flex-direction:column;
  gap:16px;
}

.full{
  display:flex;
  flex-direction:column;
  gap:8px;
}

label{
  font-size:14px;
  margin-bottom:6px;
  font-weight:500;
}

input, select{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid #d1d5db;
  font-size:15px;
}

input:focus{
  outline:none;
  border-color:var(--accent);
}

.ar{
  direction:rtl;
  text-align:right;
}

.fr{
  direction:ltr;
}

.radio-group{
  display:grid;
  grid-template-columns:1fr;
  gap:12px;
  margin-top:8px;
}

.radio-group label{
  display:flex;
  align-items:center;
  gap:12px;
  padding:12px 14px;
  border:1px solid #e5e7eb;
  border-radius:12px;
  cursor:pointer;
  background:#f9fafb;
  font-size:15px;
  margin-bottom:0;
}

.radio-group input[type="radio"]{
  width:auto;
  transform:scale(1.2);
  margin:0;
}

.actions{
  margin-top:20px;
  display:flex;
  flex-direction:column;
  gap:12px;
}

button{
  padding:14px;
  border-radius:14px;
  border:none;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
  transition: all 0.3s;
}

button:disabled{
  opacity:0.5;
  cursor:not-allowed;
}

button.primary{
  background:var(--accent);
  color:white;
}

button.primary:hover:not(:disabled){
  background:#1a52a8;
}

button.secondary{
  background:#eef2ff;
  color:var(--accent);
}

button.secondary:hover{
  background:#dce4ff;
}

@media (max-width:600px){
  header.top img{width:170px;}
}
  </style>
</head>

<body>

<div class="card">
  <header class="top">
    <img src="usmba_90h.png" alt="logo" class="logo">
    <div>
      <h1>Formulaire ‚Äî Facult√©</h1>
      <p>Remplissez les informations de l'√©tudiant(e)</p>
    </div>
  </header>

  <form id="studentForm">

    <div class="full">
      <label>Nom *</label>
      <input name="nom_ar" class="ar" placeholder="ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑÿπÿßÿ¶ŸÑŸä ÿ®ÿßŸÑÿπÿ±ÿ®Ÿäÿ©" required>
      <input name="nom_fr" class="fr" placeholder="Nom en fran√ßais" required>
    </div>

    <div class="full">
      <label>Pr√©nom *</label>
      <input name="prenom_ar" class="ar" placeholder="ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑÿ¥ÿÆÿµŸä ÿ®ÿßŸÑÿπÿ±ÿ®Ÿäÿ©" required>
      <input name="prenom_fr" class="fr" placeholder="Pr√©nom en fran√ßais" required>
    </div>

    <div class="full">
      <label>Intitul√© du dipl√¥me universitaire / certificat *</label>
      <input name="directeur_un" class="fr" placeholder="Intitul√© du dipl√¥me ou certificat" required>
    </div>

    <div>
      <label>Qualit√© *</label>
      <div class="radio-group">
        <label><input type="radio" name="qualite" value="√âtudiant" required> √âtudiant</label>
        <label><input type="radio" name="qualite" value="R√©sident"> R√©sident</label>
        <label><input type="radio" name="qualite" value="Sp√©cialit√©"> Sp√©cialit√©</label>
        <label><input type="radio" name="qualite" value="Professeur"> Professeur</label>
      </div>
    </div>

    <div>
      <label>Directeur du dipl√¥me *</label>
      <input name="directeur_fr" class="fr" placeholder="Nom du directeur du dipl√¥me" required>
    </div>

    <div class="full">
      <label>E-mail *</label>
      <input type="email" name="email" placeholder="exemple@domaine.com" required>
    </div>

    <div>
      <label>CIN *</label>
      <input name="cin_fr" class="fr" placeholder="CIN (ex: AB123456)" required>
    </div>

    <div>
      <label>T√©l√©phone *</label>
      <input type="tel" name="tel" placeholder="0600000000" required>
    </div>

    <div class="full">
      <label>Date de naissance *</label>
      <input type="date" name="date_naissance" required>
    </div>

    <div class="full">
      <label>Lieu de naissance *</label>
      <input name="lieu_ar" class="ar" placeholder="ŸÖŸÉÿßŸÜ ÿßŸÑŸàŸÑÿßÿØÿ© ÿ®ÿßŸÑÿπÿ±ÿ®Ÿäÿ©" required>
      <input name="lieu_fr" class="fr" placeholder="Lieu de naissance en fran√ßais" required>
    </div>

    <div class="actions">
      <button type="reset" class="secondary">R√©initialiser</button>
      <button type="button" class="primary" id="exportWord">Exporter vers Word</button>
      <button type="button" class="primary" id="saveDB">Enregistrer</button>
    </div>

  </form>
</div>

<script src="https://unpkg.com/pizzip@3.1.7/dist/pizzip.js"></script>
<script src="https://unpkg.com/docxtemplater@3.50.0/build/docxtemplater.js"></script>
<script src="https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js"></script>

<script>
document.getElementById("exportWord").addEventListener("click", async () => {
  const btn = document.getElementById("exportWord");
  const originalText = btn.textContent;
  
  try {
    // ÿ™ÿπÿ∑ŸäŸÑ ÿßŸÑÿ≤ÿ± ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑŸÖÿπÿßŸÑÿ¨ÿ©
    btn.disabled = true;
    btn.textContent = "‚è≥ Chargement...";
    
    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÖŸÉÿ™ÿ®ÿßÿ™
    if (typeof PizZip === 'undefined') {
      throw new Error("‚ùå Erreur: PizZip non charg√©. Actualisez la page.");
    }
    
    if (typeof window.docxtemplater === 'undefined') {
      throw new Error("‚ùå Erreur: Docxtemplater non charg√©. Actualisez la page.");
    }

    // ÿ¨ŸÑÿ® ŸÖŸÑŸÅ ÿßŸÑŸÇÿßŸÑÿ® ŸÖŸÜ ŸÜŸÅÿ≥ ÿßŸÑŸÖÿ¨ŸÑÿØ
    btn.textContent = "‚è≥ Chargement du mod√®le...";
    const response = await fetch("liste.docx");
    
    if (!response.ok) {
      throw new Error("‚ùå Le fichier 'liste.docx' est introuvable dans le m√™me dossier que ce fichier HTML.\n\nAssurez-vous que:\n1. Le fichier s'appelle exactement 'liste.docx'\n2. Il est dans le m√™me dossier que ce fichier HTML\n3. Vous avez t√©l√©charg√© les changements sur le serveur");
    }
    
    const content = await response.arrayBuffer();
    console.log('‚úì Mod√®le charg√© depuis le serveur');

    const zip = new PizZip(content);
    
    // ÿ•ŸÜÿ¥ÿßÿ° docxtemplater
    const doc = new window.docxtemplater(zip, { 
      paragraphLoop: true, 
      linebreaks: true,
      nullGetter: function(part) {
        if (!part.module) {
          return "";
        }
        if (part.module === "rawxml") {
          return "";
        }
        return "";
      }
    });

    // ÿ¨ŸÖÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨
    btn.textContent = "‚è≥ Traitement des donn√©es...";
    const formData = new FormData(document.getElementById("studentForm"));
    const data = {};
    
    for (const [key, value] of formData.entries()) {
      data[key] = value.trim();
    }
    
    data.date = new Date().toLocaleDateString("fr-FR");
    
    console.log('üìù Donn√©es:', data);

    // ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÇÿßŸÑÿ®
    try {
      doc.render(data);
    } catch (error) {
      console.error('Erreur de rendu:', error);
      
      let errorMessage = "‚ùå Erreur lors du remplissage du document:\n\n";
      
      if (error.properties && error.properties.errors) {
        errorMessage += "Variables manquantes dans le mod√®le:\n";
        error.properties.errors.forEach((err) => {
          errorMessage += `‚Ä¢ {${err.properties.id}}\n`;
        });
        
        errorMessage += "\nüí° Variables disponibles:\n";
        errorMessage += Object.keys(data).map(key => `{${key}}`).join(', ');
      } else {
        errorMessage += error.message;
      }
      
      throw new Error(errorMessage);
    }

    // ÿ•ŸÜÿ¥ÿßÿ° Ÿàÿ≠ŸÅÿ∏ ÿßŸÑŸÖŸÑŸÅ
    btn.textContent = "‚è≥ G√©n√©ration du fichier...";
    const blob = doc.getZip().generate({ 
      type: "blob",
      mimeType: "application/vnd.openxmlformats-officedocument.wordprocessingml.document"
    });
    
    saveAs(blob, "liste_inscrit_2025_2026.docx");
    
    btn.textContent = "‚úÖ Export√©!";
    setTimeout(() => {
      btn.textContent = originalText;
      btn.disabled = false;
    }, 2000);
    
    alert("‚úÖ Document export√© avec succ√®s!");

  } catch (error) {
    console.error('‚ùå Erreur:', error);
    alert(error.message);
    btn.textContent = originalText;
    btn.disabled = false;
  }
});

document.getElementById("saveDB").addEventListener("click", () => {
  alert("‚ÑπÔ∏è Le bouton Enregistrer est destin√© au serveur.\nGitHub Pages ne supporte pas les bases de donn√©es.");
});
</script>

</body>
</html>

