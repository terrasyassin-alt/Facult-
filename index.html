<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Formulaire ‚Äî Facult√©</title>
  <link rel="icon" type="image/png" href="e6BLSyxAVseR42LJ9kswxr1I8SIc9debjnAs8f3C_medium.webp">
  <style>
:root{
  --bg:#f4f7fb;
  --card:#ffffff;
  --accent:#2065d1;
  --muted:#6b7280;
  --radius:16px;
  --error:#dc2626;
}

*{
  box-sizing:border-box;
  font-family: system-ui, -apple-system, BlinkMacSystemFont,
               "Segoe UI", Roboto, Arial, "Amiri", serif;
}

body{
  margin:0;
  background:linear-gradient(180deg,#eef4ff,#f8fafc);
  min-height:100vh;
  display:flex;
  justify-content:center;
  padding:14px;
}

.card{
  background:var(--card);
  width:100%;
  max-width:720px;
  border-radius:var(--radius);
  box-shadow:0 15px 40px rgba(0,0,0,.08);
  padding:18px;
}

header.top{
  text-align:center;
  margin-bottom:22px;
}

header.top img{
  width:140px;
  margin-bottom:12px;
  height:auto;
  max-width:90%;
}

header.top h1{
  font-size:22px;
  margin:6px 0;
}

header.top p{
  font-size:14px;
  color:var(--muted);
  margin:0;
}

form{
  display:flex;
  flex-direction:column;
  gap:16px;
}

.full{
  display:flex;
  flex-direction:column;
  gap:8px;
}

label{
  font-size:14px;
  margin-bottom:6px;
  font-weight:500;
}

input, select{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid #d1d5db;
  font-size:15px;
  transition: border-color 0.3s;
}

input:focus{
  outline:none;
  border-color:var(--accent);
}

input.error{
  border-color:var(--error);
  background:#fef2f2;
}

.error-message{
  color:var(--error);
  font-size:13px;
  margin-top:4px;
  display:none;
}

.error-message.show{
  display:block;
}

.ar{
  direction:rtl;
  text-align:right;
}

.fr{
  direction:ltr;
}

.radio-group{
  display:grid;
  grid-template-columns:1fr;
  gap:12px;
  margin-top:8px;
}

.radio-group label{
  display:flex;
  align-items:center;
  gap:12px;
  padding:12px 14px;
  border:1px solid #e5e7eb;
  border-radius:12px;
  cursor:pointer;
  background:#f9fafb;
  font-size:15px;
  margin-bottom:0;
  transition: all 0.3s;
}

.radio-group label:hover{
  background:#f3f4f6;
}

.radio-group input[type="radio"]{
  width:auto;
  transform:scale(1.2);
  margin:0;
}

.radio-group.error label{
  border-color:var(--error);
}

.actions{
  margin-top:20px;
  display:flex;
  flex-direction:column;
  gap:12px;
}

button{
  padding:14px;
  border-radius:14px;
  border:none;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
  transition: all 0.3s;
}

button:disabled{
  opacity:0.5;
  cursor:not-allowed;
}

button.primary{
  background:var(--accent);
  color:white;
}

button.primary:hover:not(:disabled){
  background:#1a52a8;
}

button.secondary{
  background:#eef2ff;
  color:var(--accent);
}

button.secondary:hover{
  background:#dce4ff;
}

.alert{
  padding:14px;
  border-radius:12px;
  margin-bottom:16px;
  font-size:14px;
  display:none;
}

.alert.show{
  display:block;
}

.alert.error{
  background:#fef2f2;
  border:1px solid #fecaca;
  color:var(--error);
}

@media (max-width:600px){
  header.top img{width:170px;}
}
  </style>
</head>

<body>

<div class="card">
  <header class="top">
    <img src="usmba_90h.png" alt="logo" class="logo">
    <div>
      <h1>Formulaire ‚Äî  Facult√©</h1>
      <p>Remplissez les informations de l'√©tudiant(e)</p>
    </div>
  </header>

  <div id="alertBox" class="alert error"></div>

  <form id="studentForm">

    <div class="full">
      <label>Nom *</label>
      <input name="nom_ar" class="ar" placeholder="ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑÿπÿßÿ¶ŸÑŸä ÿ®ÿßŸÑÿπÿ±ÿ®Ÿäÿ©" required>
      <input name="nom_fr" class="fr" placeholder="Nom en fran√ßais" required>
      <span class="error-message" id="error-nom">Veuillez remplir le nom</span>
    </div>

    <div class="full">
      <label>Pr√©nom *</label>
      <input name="prenom_ar" class="ar" placeholder="ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑÿ¥ÿÆÿµŸä ÿ®ÿßŸÑÿπÿ±ÿ®Ÿäÿ©" required>
      <input name="prenom_fr" class="fr" placeholder="Pr√©nom en fran√ßais" required>
      <span class="error-message" id="error-prenom">Veuillez remplir le pr√©nom</span>
    </div>

    <div class="full">
      <label>Intitul√© du dipl√¥me universitaire / certificat *</label>
      <input name="diplome" class="fr" placeholder="Intitul√© du dipl√¥me ou certificat" required>
      <span class="error-message" id="error-diplome">Veuillez remplir l'intitul√© du dipl√¥me</span>
    </div>

    <div>
      <label>Qualit√© *</label>
      <div class="radio-group" id="qualiteGroup">
        <label><input type="radio" name="qualite" value="√âtudiant" required> √âtudiant</label>
        <label><input type="radio" name="qualite" value="R√©sident" required > R√©sident</label>
        <label><input type="radio" name="qualite" value="Sp√©cialit√©" required> Sp√©cialit√©</label>
        <label><input type="radio" name="qualite" value="Professeur" required> Professeur</label>
      </div>
      <span class="error-message" id="error-qualite">Veuillez s√©lectionner une qualit√©</span>
    </div>

    <div>
      <label>Directeur du dipl√¥me *</label>
      <input name="directeur_un" class="fr" placeholder="Nom du directeur du dipl√¥me" required>
      <span class="error-message" id="error-directeur">Veuillez remplir le nom du directeur</span>
    </div>

    <div class="full">
      <label>E-mail *</label>
      <input type="email" name="email" placeholder="exemple@domaine.com" required>
      <span class="error-message" id="error-email">Veuillez entrer un email valide</span>
    </div>

    <div>
      <label>CIN *</label>
      <input name="cin_fr" class="fr" placeholder="CIN (ex: AB123456)" required>
      <span class="error-message" id="error-cin">Veuillez remplir le CIN</span>
    </div>

    <div>
      <label>T√©l√©phone *</label>
      <input type="tel" name="tel" placeholder="0600000000" required>
      <span class="error-message" id="error-tel">Veuillez remplir le t√©l√©phone</span>
    </div>

    <div class="full">
      <label>Date de naissance *</label>
      <input type="date" name="date_naissance" required>
      <span class="error-message" id="error-date">Veuillez s√©lectionner la date de naissance</span>
    </div>

    <div class="full">
      <label>Lieu de naissance *</label>
      <input name="lieu_ar" class="ar" placeholder="ŸÖŸÉÿßŸÜ ÿßŸÑŸàŸÑÿßÿØÿ© ÿ®ÿßŸÑÿπÿ±ÿ®Ÿäÿ©" required>
      <input name="lieu_fr" class="fr" placeholder="Lieu de naissance en fran√ßais" required>
      <span class="error-message" id="error-lieu">Veuillez remplir le lieu de naissance</span>
    </div>

    <div class="actions">
      <button type="reset" class="secondary">R√©initialiser</button>
      <button type="button" class="primary" id="exportWord">Exporter vers Word</button>
      <button type="button" class="primary" id="saveDB">Enregistrer</button>
    </div>

  </form>
</div>

<script src="https://unpkg.com/pizzip@3.1.7/dist/pizzip.js"></script>
<script src="https://unpkg.com/docxtemplater@3.50.0/build/docxtemplater.js"></script>
<script src="https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js"></script>

<script>
// ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨
function validateForm() {
  const form = document.getElementById("studentForm");
  let isValid = true;
  let errors = [];

  // ÿ•ÿ≤ÿßŸÑÿ© ÿ¨ŸÖŸäÿπ ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿÆÿ∑ÿ£ ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©
  document.querySelectorAll('.error-message').forEach(el => el.classList.remove('show'));
  document.querySelectorAll('input').forEach(el => el.classList.remove('error'));
  document.getElementById('qualiteGroup').classList.remove('error');

  // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÜÿµŸäÿ©
  const requiredFields = [
    { name: 'nom_ar', errorId: 'error-nom', label: 'Nom (arabe)' },
    { name: 'nom_fr', errorId: 'error-nom', label: 'Nom (fran√ßais)' },
    { name: 'prenom_ar', errorId: 'error-prenom', label: 'Pr√©nom (arabe)' },
    { name: 'prenom_fr', errorId: 'error-prenom', label: 'Pr√©nom (fran√ßais)' },
    { name: 'diplome', errorId: 'error-diplome', label: 'Intitul√© du dipl√¥me' },
    { name: 'directeur_un', errorId: 'error-directeur', label: 'Directeur du dipl√¥me' },
    { name: 'email', errorId: 'error-email', label: 'E-mail' },
    { name: 'cin_fr', errorId: 'error-cin', label: 'CIN' },
    { name: 'tel', errorId: 'error-tel', label: 'T√©l√©phone' },
    { name: 'date_naissance', errorId: 'error-date', label: 'Date de naissance' },
    { name: 'lieu_ar', errorId: 'error-lieu', label: 'Lieu de naissance (arabe)' },
    { name: 'lieu_fr', errorId: 'error-lieu', label: 'Lieu de naissance (fran√ßais)' }
  ];

  requiredFields.forEach(field => {
    const input = form.elements[field.name];
    if (!input.value.trim()) {
      isValid = false;
      input.classList.add('error');
      document.getElementById(field.errorId).classList.add('show');
      errors.push(field.label);
    }
  });

  // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ¨ŸàÿØÿ© (radio buttons)
  const qualite = form.elements['qualite'];
  let qualiteSelected = false;
  qualite.forEach(radio => {
    if (radio.checked) qualiteSelected = true;
  });
  
  if (!qualiteSelected) {
    isValid = false;
    document.getElementById('qualiteGroup').classList.add('error');
    document.getElementById('error-qualite').classList.add('show');
    errors.push('Qualit√©');
  }

  // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä
  const emailInput = form.elements['email'];
  const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (emailInput.value.trim() && !emailPattern.test(emailInput.value.trim())) {
    isValid = false;
    emailInput.classList.add('error');
    document.getElementById('error-email').classList.add('show');
    errors.push('E-mail (format invalide)');
  }

  // ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ≠ÿ∞Ÿäÿ± ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸáŸÜÿßŸÉ ÿ£ÿÆÿ∑ÿßÿ°
  const alertBox = document.getElementById('alertBox');
  if (!isValid) {
    alertBox.innerHTML = `‚ö†Ô∏è <strong>Veuillez remplir tous les champs obligatoires:</strong><br>‚Ä¢ ${errors.join('<br>‚Ä¢ ')}`;
    alertBox.classList.add('show');
    alertBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  } else {
    alertBox.classList.remove('show');
  }

  return isValid;
}

document.getElementById("exportWord").addEventListener("click", async () => {
  // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨ ÿ£ŸàŸÑÿßŸã
  if (!validateForm()) {
    return;
  }

  const btn = document.getElementById("exportWord");
  const originalText = btn.textContent;
  
  try {
    btn.disabled = true;
    btn.textContent = "‚è≥ Chargement...";
    
    if (typeof PizZip === 'undefined') {
      throw new Error("‚ùå Erreur: PizZip non charg√©. Actualisez la page.");
    }
    
    if (typeof window.docxtemplater === 'undefined') {
      throw new Error("‚ùå Erreur: Docxtemplater non charg√©. Actualisez la page.");
    }

    btn.textContent = "‚è≥ Chargement du mod√®le...";
    const response = await fetch("liste.docx");
    
    if (!response.ok) {
      throw new Error("‚ùå Le fichier 'liste.docx' est introuvable.\n\nAssurez-vous qu'il est bien t√©l√©charg√© sur GitHub dans le m√™me dossier.");
    }
    
    const content = await response.arrayBuffer();
    console.log('‚úì Mod√®le charg√©');

    const zip = new PizZip(content);
    
    const doc = new window.docxtemplater(zip, { 
      paragraphLoop: true, 
      linebreaks: true,
      nullGetter: function(part) {
        if (!part.module) return "";
        if (part.module === "rawxml") return "";
        return "";
      }
    });

    btn.textContent = "‚è≥ Traitement...";
    const formData = new FormData(document.getElementById("studentForm"));
    const data = {};
    
    for (const [key, value] of formData.entries()) {
      data[key] = value.trim();
    }
    
    data.date = new Date().toLocaleDateString("fr-FR");
    
    console.log('üìù Donn√©es:', data);

    try {
      doc.render(data);
    } catch (error) {
      console.error('Erreur de rendu:', error);
      
      let errorMessage = "‚ùå Erreur lors du remplissage:\n\n";
      
      if (error.properties && error.properties.errors) {
        errorMessage += "Variables manquantes:\n";
        error.properties.errors.forEach((err) => {
          errorMessage += `‚Ä¢ {${err.properties.id}}\n`;
        });
        
        errorMessage += "\nüí° Variables disponibles:\n";
        errorMessage += Object.keys(data).map(key => `{${key}}`).join(', ');
      } else {
        errorMessage += error.message;
      }
      
      throw new Error(errorMessage);
    }

    btn.textContent = "‚è≥ G√©n√©ration...";
    const blob = doc.getZip().generate({ 
      type: "blob",
      mimeType: "application/vnd.openxmlformats-officedocument.wordprocessingml.document"
    });
    
    saveAs(blob, "liste_inscrit_2025_2026.docx");
    
    btn.textContent = "‚úÖ Export√©!";
    setTimeout(() => {
      btn.textContent = originalText;
      btn.disabled = false;
    }, 2000);
    
    alert("‚úÖ Document export√© avec succ√®s!");

  } catch (error) {
    console.error('‚ùå Erreur:', error);
    alert(error.message);
    btn.textContent = originalText;
    btn.disabled = false;
  }
});

document.getElementById("saveDB").addEventListener("click", () => {
  // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨ ŸÇÿ®ŸÑ ÿßŸÑÿ≠ŸÅÿ∏
  if (!validateForm()) {
    return;
  }
  
  alert("‚ÑπÔ∏è Le bouton Enregistrer est destin√© au serveur.\nGitHub Pages ne supporte pas les bases de donn√©es.");
});

// ÿ•ÿ≤ÿßŸÑÿ© ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿÆÿ∑ÿ£ ÿπŸÜÿØ ÿßŸÑŸÉÿ™ÿßÿ®ÿ©
document.querySelectorAll('input').forEach(input => {
  input.addEventListener('input', function() {
    this.classList.remove('error');
    const errorId = 'error-' + this.name.split('_')[0];
    const errorEl = document.getElementById(errorId);
    if (errorEl) {
      errorEl.classList.remove('show');
    }
  });
});

// ÿ•ÿ≤ÿßŸÑÿ© ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿÆÿ∑ÿ£ ÿπŸÜÿØ ÿßÿÆÿ™Ÿäÿßÿ± radio button
document.querySelectorAll('input[name="qualite"]').forEach(radio => {
  radio.addEventListener('change', function() {
    document.getElementById('qualiteGroup').classList.remove('error');
    document.getElementById('error-qualite').classList.remove('show');
  });
});
</script>

</body>
</html>





